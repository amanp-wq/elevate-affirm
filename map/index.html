<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live Job Map - ElevateMe.pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://unpkg.com" crossorigin>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css">
    <style>
        :root {
            --primary: #C7493A;        /* rgb(199, 73, 58) - primary brand color */
            --secondary: #488A6D;      /* rgb(72, 138, 109) - secondary color */
            --dark: #161616;           /* rgb(22, 22, 22) - dark color */
            --light: #F8F8F8;          /* rgb(248, 248, 248) - light background */
            --darker: #1B1B1B;         /* rgb(27, 27, 27) - darker color */
            --white: #FFFFFF;          /* rgb(255, 255, 255) - white */
            --black: #000000;          /* rgb(0, 0, 0) - black */
            --gray: #555555;           /* rgb(85, 85, 85) - gray */
            --light-gray: #DEDEDE;     /* Light gray for borders */
        }
        
        body {
            background: linear-gradient(var(--light), #e6e9ef);
            margin: 0;
            font-family: Inter, sans-serif;
            color: var(--dark);
        }
        
        #map {
            width: 100%;
            height: 100vh;
        }
        
        #header {
            color: var(--dark);
            z-index: 1000;
            background: rgba(255, 255, 255, 0.92);
            border-left: 6px solid var(--primary);
            border-radius: 12px;
            width: 320px;
            padding: 20px 28px;
            position: absolute;
            top: 20px;
            left: 20px;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(5px);
        }
        
        #header h2 {
            margin: 0;
            font-size: 22px;
            font-weight: 600;
        }
        
        #header p {
            opacity: .8;
            margin: 4px 0 0;
            font-size: 14px;
        }
        
        .leaflet-popup-content-wrapper {
            color: var(--white);
            background: var(--primary);
            border-radius: 10px;
            font-family: Inter, sans-serif;
            font-size: 14px;
            box-shadow: 0 0 12px #0006;
        }
        
        .leaflet-popup-tip {
            background: var(--primary);
        }
        
        .job-entry {
            cursor: pointer;
            background: linear-gradient(to bottom right, var(--white), var(--light));
            border-left: 4px solid var(--primary);
            border-radius: 12px;
            padding: 14px 16px;
            transition: transform .2s, box-shadow .2s;
            box-shadow: 0 4px 10px rgba(199, 73, 58, 0.1);
        }
        
        .job-entry:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 16px rgba(199, 73, 58, 0.2);
        }
        
        #job-list-panel {
            transition: all .3s;
        }
        
        #progress-container {
            background: #e0e0e0;
            border-radius: 8px;
            width: 100%;
            height: 10px;
            margin-top: 12px;
            overflow: hidden;
        }
        
        #progress-bar {
            background: var(--primary);
            width: 0%;
            height: 100%;
            transition: width .3s;
        }
        
        #progress-text {
            color: var(--primary);
            margin-top: 6px;
            font-size: 12px;
            font-weight: 500;
        }
        
        .fade {
            opacity: 0;
            transition: opacity .8s ease-in-out;
        }
        
        .fade.show {
            opacity: 1;
        }
        
        @keyframes fadeInScale {
            0% {
                opacity: 0;
                transform: scale(.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        @keyframes pulse {
            0% {
                text-shadow: 0 0 2px var(--primary);
            }
            50% {
                text-shadow: 0 0 8px var(--primary);
            }
            to {
                text-shadow: 0 0 2px var(--primary);
            }
        }
        
        #jobFilter {
            background: var(--white) url(https://img.icons8.com/ios-filled/50/C7493A/search--v1.png) 10px/16px 16px no-repeat;
            border: 1.5px solid var(--primary);
            border-radius: 8px;
            width: calc(80% - 8px);
            margin-top: 12px;
            padding: 7px 10px 7px 34px;
            font-size: 14px;
            transition: all .3s;
            box-shadow: 0 0 0 2px rgba(199, 73, 58, 0.2);
        }
        
        #jobFilter:focus {
            outline: none;
            box-shadow: 0 0 0 2px rgba(199, 73, 58, 0.3);
        }
        
        @keyframes spinOnly {
            0% {
                transform: rotateY(0);
            }
            to {
                transform: rotateY(360deg);
            }
        }
        
        .card-spin-success {
            animation: .6s forwards spinOnly;
        }
        
        #loading-hud {
            -webkit-backdrop-filter: blur(4px);
            z-index: 8000;
            opacity: 1;
            visibility: visible;
            background: #00000059;
            justify-content: center;
            align-items: center;
            transition: opacity .3s, visibility 0s linear .3s;
            display: flex;
            position: fixed;
            inset: 0;
        }
        
        #loading-hud.hide {
            opacity: 0;
            visibility: hidden;
            transition: opacity .3s, visibility 0s linear .3s;
        }
        
        .hud-card {
            background: var(--white);
            border-left: 6px solid var(--primary);
            border-radius: 14px;
            align-items: center;
            gap: 14px;
            min-width: 280px;
            max-width: 92vw;
            padding: 18px 20px;
            font-family: Inter, sans-serif;
            display: flex;
            box-shadow: 0 16px 44px #00000040;
        }
        
        .spinner {
            border: 3px solid #dfe6ff;
            border-top-color: var(--primary);
            border-radius: 50%;
            flex: none;
            width: 28px;
            height: 28px;
            animation: .9s linear infinite spin;
        }
        
        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }
        
        .hud-lines {
            row-gap: 4px;
            display: grid;
        }
        
        #loading-title {
            color: var(--primary);
            font-size: 15px;
            font-weight: 700;
        }
        
        #loading-sub {
            color: var(--gray);
            font-size: 13px;
        }
        
        #loading-percent {
            color: var(--dark);
            font-size: 13px;
            font-weight: 600;
        }
        
        #loading-progressbar {
            clip: rect(0 0 0 0);
            width: 1px;
            height: 1px;
            position: absolute;
            overflow: hidden;
        }
        
        #elevateme-alert-overlay {
            -webkit-backdrop-filter: blur(6px);
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            background: #00000059;
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
            transition: opacity .28s, visibility 0s linear .28s;
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
        }
        
        #elevateme-alert-overlay.show {
            opacity: 1;
            visibility: visible;
            pointer-events: auto;
            transition: opacity .28s;
        }
        
        .elevateme-modal-card {
            background: var(--white);
            border-radius: 16px;
            width: 90%;
            max-width: 520px;
            padding: 28px;
            font-family: Inter, sans-serif;
            animation: .32s ease-out fadeInScale;
            position: relative;
            box-shadow: 0 12px 40px #0000004d;
        }
        
        .elevateme-modal-close {
            cursor: pointer;
            color: var(--gray);
            background: 0 0;
            border: none;
            font-size: 22px;
            position: absolute;
            top: 12px;
            right: 14px;
        }
        
        .elevateme-modal-title {
            color: var(--primary);
            align-items: center;
            gap: 8px;
            margin-top: 0;
            font-size: 20px;
            display: flex;
        }
        
        .elevateme-modal-body {
            color: var(--dark);
            margin-top: 14px;
            font-size: 14px;
            line-height: 1.6;
        }
        
        .elevateme-modal-actions {
            text-align: center;
            margin-top: 22px;
        }
        
        .elevateme-modal-ack {
            color: var(--white);
            cursor: pointer;
            background: var(--primary);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 600;
        }
        
        .elevateme-modal-ack:hover {
            background: #a93d30;
        }
        
        #earth-intro-overlay {
            z-index: 99999;
            pointer-events: none;
            background: radial-gradient(circle, var(--dark) 40%, var(--darker));
            justify-content: center;
            align-items: center;
            width: 100vw;
            height: 100vh;
            animation: .5s 3s forwards fadeOutOverlay;
            display: flex;
            position: fixed;
            top: 0;
            left: 0;
        }
        
        .earth-container {
            text-align: center;
            animation: .5s fadeIn;
        }
        
        .earth-container img {
            border-radius: 50%;
            width: 160px;
            height: 160px;
            box-shadow: 0 0 20px #0009;
        }
        
        .earth-container p {
            color: var(--white);
            margin-top: 18px;
            font-family: Inter, sans-serif;
            font-size: 16px;
        }
        
        @keyframes fadeOutOverlay {
            to {
                opacity: 0;
                visibility: hidden;
            }
        }
        
        @keyframes fadeIn {
            0% {
                opacity: 0;
                transform: scale(.95);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        #elevateme-cta-card {
            color: var(--dark);
            z-index: 999;
            background: rgba(255, 255, 255, 0.92);
            border-left: 6px solid var(--primary);
            border-radius: 12px;
            width: 320px;
            padding: 20px 22px;
            font-family: Inter, sans-serif;
            position: absolute;
            top: 284px;
            left: 0;
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(5px);
        }
        
        #elevateme-cta-card h3 {
            color: var(--primary);
            margin-top: 0;
            margin-bottom: 12px;
            font-size: 16px;
        }
        
        #elevateme-cta-card ul {
            margin-bottom: 16px;
            padding-left: 0;
            font-size: 14px;
            line-height: 1.6;
            list-style: none;
        }
        
        #elevateme-cta-card ul li:before {
            content: "‚úÖ ";
            color: var(--primary);
            font-weight: 700;
        }
        
        .cta-button {
            text-align: center;
            color: var(--white);
            background: var(--primary);
            border-radius: 8px;
            padding: 10px 14px;
            font-weight: 600;
            text-decoration: none;
            transition: background .3s;
            display: block;
        }
        
        .cta-button:hover {
            background: #a93d30;
        }
        
        .apply-btn {
            background: var(--primary);
            border-radius: 8px;
            align-items: center;
            gap: 8px;
            padding: 8px 12px;
            font-weight: 600;
            transition: transform .12s, box-shadow .12s, background .2s;
            display: inline-flex;
            box-shadow: 0 4px 10px rgba(199, 73, 58, 0.25);
            color: var(--white)!important;
            text-decoration: none!important;
        }
        
        .apply-btn:hover {
            background: #a93d30;
            transform: translateY(-1px);
            box-shadow: 0 6px 14px rgba(199, 73, 58, 0.35);
        }
        
        .apply-btn:active {
            transform: translateY(0);
            box-shadow: 0 3px 8px rgba(199, 73, 58, 0.25);
        }
        
        .apply-btn .arrow {
            font-size: 14px;
            line-height: 1;
        }
        
        .fresh-date {
            color: var(--secondary);
            font-weight: 600;
        }
        
        .fresh-pill {
            color: #0b6418;
            background: #e9f7ea;
            border: 1px solid #bde5c5;
            border-radius: 999px;
            align-items: center;
            gap: 6px;
            padding: 2px 8px;
            font-weight: 600;
            display: inline-flex;
        }
        
        .fresh-pill:before {
            content: "";
            background: var(--secondary);
            border-radius: 50%;
            width: 6px;
            height: 6px;
            display: inline-block;
        }
        
        .social-icon {
            transition: transform 0.2s;
        }
        
        .social-icon:hover {
            transform: scale(1.1);
        }
        
        /* Custom cluster styles */
        .marker-cluster-small {
            background-color: rgba(199, 73, 58, 0.7);
            border: 3px solid rgba(255, 255, 255, 0.8);
        }
        .marker-cluster-small div {
            background-color: rgba(199, 73, 58, 0.9);
            color: white;
            font-weight: bold;
        }
        
        .marker-cluster-medium {
            background-color: rgba(72, 138, 109, 0.7);
            border: 3px solid rgba(255, 255, 255, 0.8);
        }
        .marker-cluster-medium div {
            background-color: rgba(72, 138, 109, 0.9);
            color: white;
            font-weight: bold;
        }
        
        .marker-cluster-large {
            background-color: rgba(22, 22, 22, 0.7);
            border: 3px solid rgba(255, 255, 255, 0.8);
        }
        .marker-cluster-large div {
            background-color: rgba(22, 22, 22, 0.9);
            color: white;
            font-weight: bold;
        }
        
        /* IE 6-8 fallback colors */
        .leaflet-oldie .marker-cluster-small {
            background-color: rgb(199, 73, 58);
        }
        .leaflet-oldie .marker-cluster-medium {
            background-color: rgb(72, 138, 109);
        }
        .leaflet-oldie .marker-cluster-large {
            background-color: rgb(22, 22, 22);
        }
        
        .custom-marker {
            background: var(--primary);
            border: 2px solid white;
            border-radius: 50%;
            text-align: center;
            line-height: 30px;
            font-weight: bold;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
        }
    </style>
</head>
<body>
    <div id="header">
        <div id="elevateme-cta-card">
            <h3>üöÄ Elevate Your Career!</h3>
            <ul>
                <li>Personalized Career Coaching</li>
                <li>Resume & LinkedIn Optimization</li>
                <li>Skill Development Programs</li>
                <li>Job Application Strategy</li>
                <li>Interview Preparation</li>
                <li>Career Transition Support</li>
                <li>Professional Networking Guidance</li>
            </ul>
            <a href="https://elevateme.pro" target="_blank" class="cta-button">Explore Our Services</a>
        </div>
        <h2 style="align-items:center;gap:10px;margin:0;display:flex">
            Live Job Map
            <a href="https://elevateme.pro" target="_blank">
                <img src="https://placehold.co/120x40/C7493A/FFFFFF/png?text=ElevateMe" alt="ElevateMe Logo" style="height:32px">
            </a>
        </h2>
        <div style="align-items:center;gap:10px;margin-top:4px;display:flex">
            <a href="https://www.linkedin.com/company/elevateme" target="_blank" title="LinkedIn" class="social-icon">
                <img src="https://static.licdn.com/aero-v1/sc/h/akt4ae504epesldzj74dzred8" alt="LinkedIn" style="height:20px">
            </a>
            <a href="https://www.instagram.com/elevateme.pro/" target="_blank" title="Instagram" class="social-icon">
                <img src="https://static.cdninstagram.com/rsrc.php/v4/yI/r/VsNE-OHk_8a.png" alt="Instagram" style="height:20px">
            </a>
        </div>
        <p style="color:#555;margin-top:8px;font-size:14px">
            Discover career opportunities across the US, powered by ElevateMe.pro.
        </p>
        <input id="jobFilter" placeholder="Filter by Job Title..." oninput="filterMarkersDebounced()">
        <div id="last-updated" style="color:#333;margin-top:8px;font-size:12px">
            Loading jobs...
        </div>
        <div id="job-count" style="color:#333;margin-top:4px;font-size:12px">
            Pinned jobs: 0
        </div>
        <div id="progress-container">
            <div id="progress-bar"></div>
        </div>
        <div id="progress-text">Loading: 0%</div>
    </div>

    <div id="map"></div>

    <div id="loading-hud" class="hide" role="region" aria-live="polite" aria-busy="true">
        <div class="hud-card">
            <div class="spinner" aria-hidden="true"></div>
            <div class="hud-lines">
                <div id="loading-title">Loading jobs‚Ä¶</div>
                <div id="loading-sub">Fetching thousands of roles. This can take up to ~5 minutes.</div>
                <div id="loading-percent">0%</div>
            </div>
            <div id="loading-progressbar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0" aria-label="Jobs loading progress"></div>
        </div>
    </div>

    <div id="job-list-panel" style="z-index:999;background:rgba(247, 249, 252, 0.95);width:360px;height:100vh;padding:20px;display:none;position:absolute;top:0;right:0;overflow-y:auto;box-shadow:-2px 0 12px #0000001a;backdrop-filter: blur(5px);">
        <h3 id="job-list-title" style="color:var(--primary);margin-top:0;font-size:18px;font-weight:600">Jobs in this cluster</h3>
        <div id="job-list-items" style="flex-direction:column;gap:16px;display:flex"></div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
    <script>
        let filterTimer,
            allJobMarkers = [],
            clickedJobs = new Set(JSON.parse(localStorage.getItem("clickedJobs") || "[]")),
            jobsLoaded = !1,
            loadingHud = document.getElementById("loading-hud"),
            loadingPercentEl = document.getElementById("loading-percent"),
            loadingSubEl = document.getElementById("loading-sub"),
            loadingAriaBar = document.getElementById("loading-progressbar"),
            loadStartTs = Date.now(),
            LOADER_TOTAL_MS = 3e5,
            LOADER_STEPS = [
                "Warming up the map engine‚Ä¶ someone hand me a wrench üó∫Ô∏è",
                "Fetching fresh postings, still warm from the server oven üçû",
                "Teaching pins to sit, stay, and point üìçüê∂",
                "Geocoding cities while the GPS keeps saying ‚Äúrecalculating‚Äù üß≠",
                "Untangling job titles like a box of fairy lights üéÑ",
                "Herding pins into clusters, no pins were harmed üêë",
                "Removing duplicate jobs so you don‚Äôt see double üëÄ",
                "Translating tricky addresses into actual places üè†",
                "Convincing the map not to drop New York in the ocean üåä",
                "Boosting speed with coffee for the servers ‚òï",
                "Sorting by freshness so you only get the good stuff üçé",
                "Double-checking links to avoid digital dead ends üöß",
                "Smoothing rough data like butter on hot toast üßà",
                "Reminding pins to stay on land, please üë®‚Äçüè´",
                "Rendering thousands of jobs, hold my carrot ü•ï",
                "Polishing the sidebar until it sparkles ‚ú®",
                "Rehearsing pin choreography: left, right, zoom üíÉ",
                "Loading perks, sadly no free snacks üç´",
                "Getting Apply buttons ready for takeoff üõ´",
                "Rolling out the red carpet for the jobs üé•"
            ],
            reassureTimer = setInterval(() => {
                let e = Date.now() - loadStartTs,
                    t = Math.min(Math.floor(e / (3e5 / LOADER_STEPS.length)), LOADER_STEPS.length - 1);
                loadingSubEl && (loadingSubEl.textContent = LOADER_STEPS[t]), e >= 3e5 && (clearInterval(reassureTimer), reassureTimer = null)
            }, 5e3),
            reduceMotion = window.matchMedia("(prefers-reduced-motion: reduce)").matches,
            DEFAULT_CENTER = [37.8, -96],
            DEFAULT_ZOOM = 4,
            lastSearchTerm = "",
            map = L.map("map", {
                preferCanvas: !0
            }).setView(DEFAULT_CENTER, 4);
        
        // Use Esri World Imagery (Satellite) tile layer
        L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
            attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community',
            maxZoom: 18
        }).addTo(map);
        
        // Custom marker cluster group with your color palette
        let markersLayer = L.markerClusterGroup({
            iconCreateFunction: function(cluster) {
                var count = cluster.getChildCount();
                var size = count < 10 ? 'small' : count < 50 ? 'medium' : 'large';
                return L.divIcon({
                    html: '<div><span>' + count + '</span></div>',
                    className: 'marker-cluster marker-cluster-' + size,
                    iconSize: L.point(40, 40)
                });
            },
            spiderfyOnMaxZoom: true,
            showCoverageOnHover: false,
            zoomToBoundsOnClick: true,
            maxClusterRadius: 60
        }).addTo(map);
        
        let pinIcon = L.divIcon({
            html: "üìç",
            className: "custom-marker",
            iconSize: [30, 30],
            iconAnchor: [15, 15],
            popupAnchor: [0, -15]
        }),
        apiUrl = "https://script.google.com/macros/s/AKfycbwP-d7eDtJctL3sflL1z4Hn-UgkMAfb8pwkZPXb5-PL_7kBKA1YeuRYqg5SlPAl8MogvQ/exec",
        CACHE_KEY = "elevateme_map_cache_v1",
        CACHE_TTL_MS = 3e5,
        FORCE_REFRESH = new URLSearchParams(location.search).has("refresh");

        async function getJobsWithCache() {
            if (FORCE_REFRESH) try {
                localStorage.removeItem(CACHE_KEY)
            } catch (e) {} else try {
                let e = localStorage.getItem(CACHE_KEY);
                if (e) {
                    let {
                        ts: t,
                        rows: o
                    } = JSON.parse(e);
                    if (Array.isArray(o) && Date.now() - t < 3e5) return console.log("Using cached jobs:", o.length), o
                }
            } catch (e) {}
            let e = await fetch("https://script.google.com/macros/s/AKfycbwP-d7eDtJctL3sflL1z4Hn-UgkMAfb8pwkZPXb5-PL_7kBKA1YeuRYqg5SlPAl8MogvQ/exec", {
                cache: "no-store"
            });
            if (!e.ok) throw Error(`HTTP ${e.status}`);
            let t = await e.json(),
                o = Array.isArray(t) ? t : t && Array.isArray(t.data) ? t.data : [];
            try {
                let e = o.map(e => ({
                    "Job Title": e["Job Title"],
                    Company: e.Company,
                    Location: e.Location,
                    "Job URL": e["Job URL"],
                    "Last Updated Date": e["Last Updated Date"],
                    latitude: e.latitude,
                    longitude: e.longitude
                }));
                localStorage.setItem(CACHE_KEY, JSON.stringify({
                    ts: Date.now(),
                    rows: e
                }))
            } catch (e) {}
            return o
        }

        function loadMarkers(e) {
            let t = 0,
                o = e.length;

            function n() {
                if (t < o) {
                    let a = t;
                    t += 300,
                        function(t) {
                            for (let o of e.slice(t, t + 300)) {
                                let e = (o["Job Title"] || "").replace(/[^\w\s\-()\/:&]/g, "").trim(),
                                    t = o.Location,
                                    n = o["Job URL"],
                                    a = o.Company || "Unknown",
                                    l = o["Last Updated Date"] || "Not available",
                                    r = parseFloat(o.latitude),
                                    i = parseFloat(o.longitude);
                                if (!r || !i) continue;
                                let s = e.replace(/\b\w/g, e => e.toUpperCase()),
                                    d = l;
                                if (l && "Not available" !== l) {
                                    let e = new Date(l);
                                    isNaN(e) || (d = e.toLocaleString(void 0, {
                                        year: "numeric",
                                        month: "short",
                                        day: "numeric",
                                        hour: "2-digit",
                                        minute: "2-digit"
                                    }))
                                }
                                let c = `
            <div style="max-width: 240px; font-family: 'Inter', sans-serif; font-size: 14px; color: #333;">
              <div style="font-weight: 600; font-size: 16px; margin-bottom: 4px;">üìç ${s||"Job Title Not Available"}</div>
              <div style="margin-bottom: 2px;"><b>üè¢ ${a||"Unknown Company"}</b></div>
              <div style="margin-bottom: 2px;">${t||"Location Not Provided"}</div>
              <div style="margin-bottom: 8px;"><small>üïí ${d||"Not Available"}</small></div>
              <div style="margin-top: 6px;">
                <a href="${n}" target="_blank" rel="noopener noreferrer" class="apply-btn">Apply <span class="arrow" aria-hidden="true">‚Üó</span></a>
              </div>
            </div>
          `,
                                    u = L.marker([r, i], {
                                        icon: pinIcon
                                    }).bindPopup(c);
                                u.options.company = a, u.options.updated = l, u.options.location = t, u.jobTitle = e.toLowerCase(), markersLayer.addLayer(u), allJobMarkers.push(u)
                            }
                            let n = Math.min(Math.round((t + 300) / o * 100), 100),
                                a = document.getElementById("progress-bar"),
                                l = document.getElementById("progress-text"),
                                r = document.getElementById("job-count");
                            a && (a.style.width = `${n}%`), l && (l.textContent = `Loading: ${n}%`), r && (r.innerHTML = `<span id="pinned-count" style="animation: pulse 2s infinite; color: var(--primary); font-weight: 600;">üìç Pinned Jobs: ${allJobMarkers.length.toLocaleString()}</span>`), loadingPercentEl && (loadingPercentEl.textContent = n + "%"), loadingAriaBar && loadingAriaBar.setAttribute("aria-valuenow", String(n))
                        }(a), setTimeout(n, 50)
                } else {
                    loadingHud && loadingHud.classList.add("hide"), reassureTimer && (clearInterval(reassureTimer), reassureTimer = null), loadingHud && loadingHud.setAttribute("aria-busy", "false"), document.getElementById("last-updated").innerText = `Last updated: ${new Date().toLocaleString()}`, document.getElementById("job-count").innerHTML = `<span style="color: var(--primary); font-weight: 600;">üìç Pinned Jobs: ${allJobMarkers.length.toLocaleString()}</span>`;
                    let e = document.getElementById("progress-text");
                    e.innerText = "‚úÖ Done loading jobs!", loadingSubEl && (loadingSubEl.textContent = "Jobs loaded."), loadingPercentEl && (loadingPercentEl.textContent = "100%"), loadingAriaBar && loadingAriaBar.setAttribute("aria-valuenow", "100"), jobsLoaded = !0, setTimeout(() => {
                        e.classList.add("fade"), e.innerText = "Good luck in your search.", setTimeout(() => {
                            e.innerText = "", e.classList.remove("fade")
                        }, 2500)
                    }, 2e3)
                }
            }
            n()
        }

        function filterMarkersDebounced() {
            clearTimeout(filterTimer);
            let e = document.getElementById("jobFilter"),
                t = (e?.value || "").trim();
            if (0 === lastSearchTerm.length && t.length > 0) try {
                let e = document.getElementById("job-list-panel");
                e && (e.style.display = "none"), map.closePopup(), reduceMotion ? map.setView(DEFAULT_CENTER, 4) : map.flyTo(DEFAULT_CENTER, 4, {
                    duration: .6,
                    easeLinearity: .25
                })
            } catch (e) {}
            lastSearchTerm = t, filterTimer = setTimeout(filterMarkers, 300)
        }

        function filterMarkers() {
            let e = document.getElementById("jobFilter").value.toLowerCase().trim().split(/\s+/);
            markersLayer.clearLayers();
            let t = 0;
            for (let o of allJobMarkers) {
                let n = o.jobTitle;
                e.every(e => n.includes(e)) && (markersLayer.addLayer(o), t++)
            }
            document.getElementById("job-count").innerHTML = `<span style="color: var(--primary); font-weight: 600;">üìç Pinned Jobs: ${t.toLocaleString()}</span>`
        }
        getJobsWithCache().then(e => {
            if (!e.length) {
                let e = document.getElementById("progress-text");
                console.error("No rows or unexpected payload shape."), e && (e.innerText = "‚ö†Ô∏è No jobs returned."), loadingHud && (loadingSubEl.textContent = "No jobs returned from the source.", loadingPercentEl.textContent = ""), jobsLoaded = !0;
                return
            }
            loadMarkers(e)
        }).catch(e => {
            console.error("Error fetching jobs:", e);
            let t = document.getElementById("progress-text");
            t && (t.innerText = "‚ùå Failed to load jobs."), loadingHud && (loadingSubEl.textContent = "Failed to load jobs. Please refresh to retry.", loadingPercentEl.textContent = "");
            let o = document.getElementById("earth-intro-overlay");
            o && (o.style.display = "none"), jobsLoaded = !0
        }), reduceMotion || setTimeout(() => {
            map.flyTo([37.8, -96], 5, {
                duration: 3,
                easeLinearity: .25
            })
        }, 3e3), markersLayer.on("clusterclick", function(e) {
            let t = e.layer.getAllChildMarkers().slice().sort((e, t) => {
                    let o = Date.parse(e.options.updated || "") || -1 / 0;
                    return (Date.parse(t.options.updated || "") || -1 / 0) - o
                }),
                o = document.getElementById("job-list-panel"),
                n = document.getElementById("job-list-items"),
                a = document.createDocumentFragment();
            n.innerHTML = "", document.getElementById("job-list-title").innerText = `Jobs in this cluster (${t.length})`, t.forEach(e => {
                let t, o = e.jobTitle?.replace(/\b\w/g, e => e.toUpperCase()) || "Unknown";
                e.getPopup().getContent();
                let n = document.createElement("div");
                n.className = "job-entry";
                let l = e.options.updated || "Not available",
                    r = l,
                    i = !1;
                if (l && "Not available" !== l) {
                    let e = new Date(l);
                    if (!isNaN(e)) {
                        r = e.toLocaleString(void 0, {
                            year: "numeric",
                            month: "short",
                            day: "numeric",
                            hour: "2-digit",
                            minute: "2-digit"
                        });
                        let t = (new Date - e) / 864e5;
                        t >= 0 && t <= 7 && (i = !0)
                    }
                }
                let s = i ? 'class="fresh-date fresh-pill"' : 'style="opacity: 0.8; color: #666;"';
                n.innerHTML = `
          <b style="display:block; color: var(--primary);">üìç ${o}</b>
          <div><b style="color: #333;">üè¢ ${e.options.company||"Unknown"}</b></div>
          <div style="color: #555;">${e.options.location||"Unknown"}</div>
          <div><small ${s}>üïí ${r}</small></div>
          <a href="${e.getPopup().getContent().match(/href="([^"]+)"/)?.[1]}" target="_blank" rel="noopener noreferrer" class="apply-btn" style="margin-top:8px;">Apply <span class="arrow" aria-hidden="true">‚Üó</span></a>
        `;
                let d = e.getPopup().getContent().match(/href="([^"]+)"/)?.[1];
                if (clickedJobs.has(d)) {
                    let e = document.createElement("span");
                    e.textContent = " ‚úÖ", e.style.color = "#2e7d32", e.style.fontWeight = "bold", n.querySelector("b").appendChild(e)
                }
                n.querySelector('a[target="_blank"]').addEventListener("click", function(e) {
                    e.preventDefault(), n.classList.add("card-spin-success"), setTimeout(() => {
                        let e = this.href;
                        clickedJobs.add(e), localStorage.setItem("clickedJobs", JSON.stringify(Array.from(clickedJobs)));
                        let t = document.createElement("span");
                        t.textContent = " ‚úÖ", t.style.color = "#2e7d32", t.style.fontWeight = "bold", n.querySelector("b").appendChild(t), window.open(e, "_blank")
                    }, 600)
                }), n._marker = e, n.addEventListener("click", () => {
                    map.setView(e.getLatLng(), 10 > map.getZoom() ? 10 : map.getZoom()), e.openPopup()
                }), n.addEventListener("mouseenter", () => {
                    e.setZIndexOffset(1e3), e.openPopup(), t = L.circleMarker(e.getLatLng(), {
                        radius: 18,
                        color: "var(--primary)",
                        weight: 2,
                        fillOpacity: 0,
                        interactive: !1
                    }).addTo(map)
                }), n.addEventListener("mouseleave", () => {
                    e.setZIndexOffset(0), e.closePopup(), t && (map.removeLayer(t), t = null)
                }), a.appendChild(n)
            }), n.innerHTML = "", n.appendChild(a), o.style.display = "block"
        }), map.on("click", function() {
            document.getElementById("job-list-panel").style.display = "none"
        });
        let resetZoomControl = L.Control.extend({
            options: {
                position: "topleft"
            },
            onAdd: function() {
                let e = L.DomUtil.create("div", "leaflet-bar leaflet-control leaflet-control-custom");
                return e.innerHTML = `
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rotate-ccw">
            <polyline points="1 4 1 10 7 10"></polyline>
            <path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path>
          </svg>`, e.style.backgroundColor = "white", e.style.width = "30px", e.style.height = "30px", e.style.cursor = "pointer", e.style.display = "flex", e.style.alignItems = "center", e.style.justifyContent = "center", e.style.transition = "all 0.2s ease-in-out", e.title = "Reset Map View", e.setAttribute("role", "button"), e.setAttribute("aria-label", "Reset map view"), e.tabIndex = 0, e.onkeydown = t => {
                    ("Enter" === t.key || " " === t.key) && (t.preventDefault(), e.click())
                }, e.onmouseenter = () => {
                    e.style.backgroundColor = "#f0f0f0", e.style.transform = "scale(1.05)"
                }, e.onmouseleave = () => {
                    e.style.backgroundColor = "white", e.style.transform = "scale(1)"
                }, e.onclick = function() {
                    map.setView(DEFAULT_CENTER, 4);
                    let t = e.querySelector("svg");
                    t.style.transition = "transform 0.5s ease", t.style.transform = "rotate(-360deg)", setTimeout(() => {
                        t.style.transform = "rotate(0deg)"
                    }, 500)
                }, e
            }
        });
        map.addControl(new resetZoomControl), window.onload = () => {
            let e = document.getElementById("elevateme-alert-overlay"),
                t = document.getElementById("close-elevateme-alert"),
                o = document.getElementById("acknowledge-elevateme-alert"),
                n = () => {
                    e.classList.remove("show"), document.body.style.overflow = "auto", loadingHud && (jobsLoaded ? (loadingHud.classList.add("hide"), loadingHud.setAttribute("aria-busy", "false")) : (loadingHud.classList.remove("hide"), loadingHud.setAttribute("aria-busy", "true")))
                };
            setTimeout(() => {
                e.classList.add("show"), document.body.style.overflow = "hidden", (o || t).focus({
                    preventScroll: !0
                })
            }, 3200), t.onclick = n, o.onclick = n, document.addEventListener("keydown", e => {
                "Escape" === e.key && n()
            }), e.addEventListener("click", t => {
                t.target === e && n()
            })
        };
    </script>
    <div id="earth-intro-overlay">
        <div class="earth-container">
            <img src="https://upload.wikimedia.org/wikipedia/commons/e/e1/Rotating_earth_animated.gif" alt="Spinning Earth">
            <p>Loading Live Job Map Powered by ElevateMe.pro...</p>
        </div>
    </div>
    <footer style="color:var(--gray);z-index:999;background:rgba(255, 255, 255, 0.9);border-radius:8px;padding:6px 12px;font-family:Inter,sans-serif;font-size:12px;position:fixed;bottom:6px;left:50%;transform:translate(-50%);backdrop-filter: blur(5px);">
        ¬© 2025 ElevateMe.pro |
        <a href="https://elevateme.pro/privacy-policy/" target="_blank" style="color:var(--primary);text-decoration:none">Privacy Policy</a> |
        <a href="https://elevateme.pro/terms-of-use/" target="_blank" style="color:var(--primary);text-decoration:none">Terms of Use</a>
    </footer>

    <div id="elevateme-alert-overlay" role="dialog" aria-modal="true" aria-labelledby="elevateme-notice-title" aria-describedby="elevateme-notice-desc">
        <div class="elevateme-modal-card">
            <button id="close-elevateme-alert" class="elevateme-modal-close" aria-label="Close notice">√ó</button>
            <h3 id="elevateme-notice-title" class="elevateme-modal-title">‚úÖ <span>Notice from ElevateMe</span></h3>
            <div id="elevateme-notice-desc" class="elevateme-modal-body">
                <p><b>Before you explore</b> : This Live Job Map helps you discover active opportunities faster. We aggregate publicly available postings and partner feeds; ElevateMe isn‚Äôt affiliated with companies unless stated.</p>
                <ul style="margin:8px 0 0 18px">
                    <li>Listings can update or close without notice; always verify on the company site via <b>Apply</b>.</li>
                    <li>Data refreshes in near real time and may be cached for short periods.</li>
                    <li>Pin locations are city‚Äëlevel approximations; exact offices may vary.</li>
                    <li>We do not guarantee accuracy, completeness, availability, or outcomes.</li>
                    <li>Sometimes a pin sails into the ocean üåä, the job‚Äôs fine, but incomplete addresses make our map lose its compass üòÖ.</li>
                </ul>
                <p style="margin-top:10px">By continuing, you acknowledge the above and accept our
                    <a href="https://elevateme.pro/terms-of-use/" target="_blank" rel="noopener noreferrer" style="color:var(--primary)">Terms</a> and
                    <a href="https://elevateme.pro/privacy-policy/" target="_blank" rel="noopener noreferrer" style="color:var(--primary)">Privacy</a>.
                </p>
                <p style="margin-top:10px><b>Need guidance?</b> For tailored career coaching, resume optimization, and interview preparation, explore our services.</p>
            </div>
            <div class="elevateme-modal-actions">
                <button id="acknowledge-elevateme-alert" class="elevateme-modal-ack">Got it ‚úÖ</button>
            </div>
        </div>
    </div>
</body>
</html>